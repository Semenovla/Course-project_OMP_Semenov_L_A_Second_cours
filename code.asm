.model small
.stack 256H
.data
mes1 db 10, 13, 10, 13, '0. Cezar',10,13 ,'1. bToNum',10,13, '2. Exit $'
mes db 10, 13, 10, 13,'Enter message: $'
mes2 db 10, 13,'Enter key: $'
mes3 db 10, 13,10, 13,'0. Encrypt, 1. Decrypt: $'
msg1 db 10, 13, 'Result: $'
f db 6 dup('$')
mes30 db 10, 13,10, 13,'0. Encrypt, 1. Decrypt: $'
vvod db 50 dup('$')
mes31 db 10, 13,10, 13,'0. Encrypt, 1. Decrypt: $'
ent db 13, 10, '$'
key db 0
keystr db 6 dup('$')
tmp db 6 dup('$')

.code

bToNum proc; ??? ??????? ?????????? ?? ???? ? ?????, A=1, B=2 ? ?.?.
mov si, 2


m1:
xor ah, ah
cmp vvod[si+1], '$'; ???? ????????? ????? ??????
je m0; ?? ??????????? ?? ?????????


mov al, vvod[si]; ?????? ? ?? ??????
cmp al, 'A'
jl m4; ???? ?????? ?????? ??? ?, ?? ??????? ?? ?4
cmp al, 'Z'
jg m2; ???? ?????? ??? Z, ?? ?? ?2

sub al, 64; ???????? 64, ??? ?????????? ? ?????
call PrintNumber; ???????
jmp m3; ??????? ?? ?3

m2:
cmp al, 'a'; ???? ?????? ??? ?
jl m4; ?? ??????? ?? ?4
cmp al, 'z'; ???? ?????? ??? z
jg m4; ?? ?? ?4

sub al, 96; ???????? 96
call PrintNumber; ? ???????

m3:
inc si; ??????????? ???????, ??????? ?????????? ?? ??????
cmp vvod[si], 'A';
jl m30; ???? ?????? ??? ?, ??????? ?? ?30
cmp vvod[si], 'z'; ?????? ??? z
jg m30; ?? ?30
mov dl, '-';
mov ah,02h
int 21h; ??????? ?? ????? '-'
m30:
jmp m1

m4:
mov dl, al
mov ah,02h
int 21h;??? ??????? ??????
inc si
jmp m1

m0:
ret
bToNum endp

deBToNum proc; ??????? ????????????, ?????? ??? ????????, 1=A, 2=B
mov di, 2

d0:
mov si, 0
d1:
cmp vvod[di], '$'; ?????????? ? ?????? ??????
je d4; ???? ????? - ????????
mov al, vvod[di]
cmp al, '0'; ???? ?????? ?????? ??? "0"
jl d2; ??????? ?? d2
cmp al, '9'
jg d2; ?????? ??? 9, ?? ??????? ?? ?2
mov tmp[si], al; ????????? ?????? ?? ????????? ??????
inc di; ??????????? ????????
inc si
jmp d1

d2:
cmp si, 0; ?????????? si ? ?????
je skip30; ???? ????, ?? ?? ?? ????? ?? ???? ?????, ?????? ??????? ?????? ?? ?????
lea si, tmp; ?????? ????? ????????? ?????? ? ??
call str2dw; ?????????? ? ?????
mov dx, ax
add dx, 64; ????????? 64, ????? ?????????? ? ?????
mov ah, 02h
int 21h; ? ???????
mov si, 0
mov tmp[si], '$'; ??????? ????????? ??????
mov tmp[si+1], '$'
mov tmp[si+2], '$'

skip30:
cmp vvod[di], '-'
je skip3
mov dl, vvod[di]
mov ah, 02h
int 21h;??????? ??????, ???? ??? ?? "-"
skip3:
inc di

jmp d0

d4:
ret
deBToNum endp

str2dw proc; ??????? ???????? ?????? ? ?????
xor dx,dx ;?????
nch: xor ax,ax
lodsb ;????? c????? ?? ?????? si ? al
test al,al ;???? ??? ????? ????, ?? ???????????
jz ex
cmp al,'9' ;???? ??? ?? ?????, ?? ??????????
jnbe nch
cmp al,'0' ;???? ??? ?? ?????, ?? ??????????
jb nch
sub ax,'0' ;???????? ???????? ????????
shl dx,1 ;???????? ????? ?? 10
add ax, dx
shl dx, 2
add dx, ax ;?????????? ??????? ????????
jmp nch
ex: mov ax,dx
ret
str2dw endp

Cezar proc; ??? ??????? ??????? ??????. ?????? ????????? ? ??????? ??????? ??? ????, ? ???? ????? ?????? ?? ??????? ????????, ??????? ? ?????? ?????? ????????
push cx
push bx
push di
mov si, 2
lp1:
cmp vvod[si], '$'
je exs
mov al, vvod[si]
mov bl, vvod[si]
add al, key
cmp bl, 'Z'
jg skip2
cmp al, 'Z'
jle skip1
sub al, 26
skip2:
cmp al, 'z'
jle skip1
sub al, 26
skip1:
mov vvod[si], al
inc si
jmp lp1
exs:
pop di
pop bx
pop cx
ret
Cezar endp

deCezar proc; ??? ????????? ??????? ??????
push cx
push bx
push di
mov si, 2
deLp1:
cmp vvod[si], '$'
je deExs
mov al, vvod[si]
mov bl, vvod[si]
sub al, key
cmp bl, 'Z'
jg deSkip2
cmp al, 'A'
jge deSkip1
add al, 26
jmp deSkip1
deSkip2:
cmp al, 'a'
jge deSkip1
add al, 26
deSkip1:
mov vvod[si], al
inc si
jmp deLp1
deExs:
pop di
pop bx
pop cx
ret
deCezar endp

PrintNumber proc ;????????? ?????? ????? ?? AX
push BX ;????????? ?????????? ????????? ?
push AX
push DX
push SI
push CX
mov CX, 0 ;?????????????? ????
mov BX, 10 ;? BX ??????? ????????? ??????? ?????????
loophere: ;???????? ????
mov DX, 0 ;???????? DX
div BX ;????? ?? 10
push AX ;????????? ? ?????
add DL, "0" ;???????????? ????????? ????? ? ASCII-???
pop AX ;?????? AX
push DX ;???????? DX
inc CX ;???????? CX ?? 1
cmp AX, 0 ;????????? ??? ???? ???? ?????
jnz loophere
mov AH, 2 ;DOS-??????? ?????? ???????
loophere2:
pop DX ;??????????????? ????? ?? ????????? ? ?????? ?
mov AH, 02h ;??????? ?? ?? ?????
int 21h
loop loophere2
pop CX
pop SI
pop DX
pop BX
pop AX
ret
PrintNumber endp

start:
mov ax, @data
mov ds,ax

start0:

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, mes1 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

;?????? ????? ?? ??????
lea dx, f; ?????? ????? ?????? ? dx
mov ah, 0ah; ?????????? ????? ? ???????
int 21h;??? ?? ?????? ?????? ? ???????

mov si, 2

cmp f[si], '0'
je Cezar0; ???? ????, ?? ??????? ?? ?????????? ???????

cmp f[si], '1'
je bToNum0; ???? 1 - ?? ??????? ???? ? ?????

mov ax,4c00h ;????????? ?????????
int 21h

Cezar0:

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, mes3 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

;????? ????? ?????? ????? ?? ??????, ????????? ??? ???????????
lea dx, f; ?????? ????? ?????? ? dx
mov ah, 0ah; ?????????? ????? ? ???????
int 21h;??? ?? ?????? ?????? ? ???????



mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, mes ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

lea dx, vvod; ?????? ????? ?????? ? dx
mov ah, 0ah; ?????????? ????? ? ???????
int 21h;??? ?? ?????? ?????? ? ???????

mov si, 1
xor ah, ah
mov al, vvod[si]
add si, ax
inc si
mov vvod[si], '$'

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, mes2 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

;?????? ???? ??????????
lea dx, keystr; ?????? ????? ?????? ? dx
mov ah, 0ah; ?????????? ????? ? ???????
int 21h;??? ?? ?????? ?????? ? ???????

lea si, keystr
call str2dw;? ?????????? ??? ???? ? ?????, ??? ??? ????? ??? ? ????????? ???????
mov key, al



mov si, 2
cmp f[si], '1'
je deCrypt; ???? ????? 1 - ?? ??????? ?? ????????????

call Cezar; ????? ???????? ?????????? ???????
jmp vivod; ??????? ? ??????

deCrypt:
call deCezar; ???????? ????????????

vivod:
mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, msg1 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, vvod ;????? ????? ??????
inc dx
inc dx
int 21h ;????? ?????????? ??? ?????? ??????

jmp start0; ? ???????????? ? ?????? ?????????

bToNum0:
mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, mes3 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

lea dx, f; ?????? ????? ?????? ? dx
mov ah, 0ah; ?????????? ????? ? ???????
int 21h;??? ?? ?????? ?????? ? ???????

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, mes ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

lea dx, vvod; ?????? ????? ?????? ? dx
mov ah, 0ah; ?????????? ????? ? ???????
int 21h;??? ?? ?????? ?????? ? ???????


mov si, 2
cmp f[si], '1'
je deCrypt0

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, msg1 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

call bToNum

jmp start0


deCrypt0:

mov ah, 9 ;??????? 9 ?????????? 21h - ????? ?????? ?? ?????
lea dx, msg1 ;????? ????? ??????
int 21h ;????? ?????????? ??? ?????? ??????

call deBToNum

jmp start0

ext:
mov ax,4c00h ;????????? ?????????
int 21h

end start